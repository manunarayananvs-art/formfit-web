<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormFit - Private Image Compressor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .drop-zone { border: 2px dashed #0d6efd; border-radius: 10px; padding: 40px; text-align: center; background: white; cursor: pointer; transition: 0.3s; }
        .drop-zone:hover { background-color: #e9ecef; }
        .preview-img { max-width: 100%; height: auto; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .badge-safe { background-color: #d1e7dd; color: #0f5132; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container mt-5" style="max-width: 600px;">
    <div class="text-center mb-4">
        <h1>üñºÔ∏è FormFit</h1>
        <p class="text-muted">Compress images for forms securely.</p>
        <span class="badge-safe">üîí Local Processing (Images never leave your device)</span>
    </div>

    <div class="drop-zone mb-4" onclick="document.getElementById('imageInput').click()">
        <h4>Tap to Select Image</h4>
        <p class="text-muted small">Supports JPG, PNG, WEBP</p>
        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
    </div>

    <div id="controlsArea" class="card p-3 shadow-sm" style="display: none;">
        <div class="row">
            <div class="col-6 text-center">
                <h6>Original</h6>
                <p id="originalSize" class="small text-danger"></p>
            </div>
            <div class="col-6 text-center">
                <h6>Compressed</h6>
                <p id="compressedSize" class="small text-success">Processing...</p>
            </div>
        </div>

        <label class="form-label fw-bold mt-2">Target Size (KB)</label>
        <div class="d-flex gap-2 mb-3">
            <button class="btn btn-outline-secondary btn-sm" onclick="setTarget(20)">20KB (Sign)</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="setTarget(50)">50KB (Photo)</button>
            <button class="btn btn-outline-secondary btn-sm" onclick="setTarget(100)">100KB (Doc)</button>
        </div>
        
        <input type="range" class="form-range" id="sizeSlider" min="10" max="500" step="10" value="50" oninput="updateSliderVal(this.value)">
        <p class="text-center small">Target: <span id="sliderValue">50</span> KB</p>

        <button class="btn btn-primary w-100 mt-2" onclick="compressImage()">Compress Now</button>
        
        <div id="downloadArea" class="mt-3 text-center" style="display: none;">
            <a id="downloadLink" href="#" download="formfit_compressed.jpg" class="btn btn-success w-100">‚¨áÔ∏è Download Image</a>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.0/dist/browser-image-compression.js"></script>

<script>
    let originalFile = null;

    function handleImageUpload(event) {
        originalFile = event.target.files[0];
        if (!originalFile) return;

        // Show UI
        document.getElementById('controlsArea').style.display = 'block';
        document.getElementById('originalSize').innerText = (originalFile.size / 1024).toFixed(2) + " KB";
        document.getElementById('downloadArea').style.display = 'none';
        
        // Auto compress with default logic initially
        compressImage();
    }

    function setTarget(kb) {
        document.getElementById('sizeSlider').value = kb;
        updateSliderVal(kb);
        compressImage();
    }

    function updateSliderVal(val) {
        document.getElementById('sliderValue').innerText = val;
    }

    async function compressImage() {
        const targetKB = document.getElementById('sizeSlider').value;
        const targetMB = targetKB / 1024; // Convert to MB for library

        const options = {
            maxSizeMB: targetMB,
            maxWidthOrHeight: 1920,
            useWebWorker: true
        };

        try {
            document.getElementById('compressedSize').innerText = "Compressing...";
            const compressedFile = await imageCompression(originalFile, options);
            
            document.getElementById('compressedSize').innerText = (compressedFile.size / 1024).toFixed(2) + " KB";
            
            // Create Download Link
            const downloadLink = document.getElementById('downloadLink');
            downloadLink.href = URL.createObjectURL(compressedFile);
            document.getElementById('downloadArea').style.display = 'block';

        } catch (error) {
            console.log(error);
            alert("Could not compress image.");
        }
    }
</script>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries
</script>

</body>
</html>
